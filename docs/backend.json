
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the AutoWealth platform.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user.",
          "format": "uuid"
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "name": {
          "type": "string",
          "description": "Full name of the user."
        },
        "phone": {
          "type": "string",
          "description": "Phone number of the user."
        },
        "ghanaCard": {
          "type": "string",
          "description": "Ghana Card number of the user."
        },
        "bankDetails": {
          "type": "string",
          "description": "Bank details of the user (JSON format)."
        },
        "balance": {
          "type": "number",
          "description": "Current balance of the user's account."
        },
        "totalEarned": {
          "type": "number",
          "description": "Total earnings of the user."
        },
        "referralCode": {
          "type": "string",
          "description": "Unique referral code for the user."
        },
        "referredById": {
          "type": "string",
          "description": "ID of the user who referred this user."
        },
        "referralEarnings": {
            "type": "number",
            "description": "Total earnings from referrals."
        },
        "totalInvested": {
            "type": "number",
            "description": "Total amount invested by the user."
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time when the user account was created.",
          "format": "date-time"
        },
        "updatedAt": {
          "type": "string",
          "description": "Date and time when the user account was last updated.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "referralCode",
        "createdAt",
        "updatedAt"
      ]
    },
    "Investment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Investment",
      "type": "object",
      "description": "Represents an investment made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the investment."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Investment)"
        },
        "carId": {
          "type": "string",
          "description": "Reference to Car. (Relationship: Car 1:N Investment)"
        },
        "amount": {
          "type": "number",
          "description": "Amount invested."
        },
        "duration": {
          "type": "number",
          "description": "Duration of the investment in months."
        },
        "roi": {
          "type": "number",
          "description": "Return on investment percentage."
        },
        "startDate": {
          "type": "string",
          "description": "Start date of the investment.",
          "format": "date-time"
        },
        "endDate": {
          "type": "string",
          "description": "End date of the investment.",
          "format": "date-time"
        },
        "status": {
          "type": "string",
          "description": "Status of the investment (e.g., active, completed, pending)."
        },
        "dailyProfit": {
          "type": "number",
          "description": "Daily profit earned from the investment."
        },
        "totalProfit": {
          "type": "number",
          "description": "Total profit earned from the investment."
        }
      },
      "required": [
        "id",
        "userId",
        "carId",
        "amount",
        "duration",
        "roi",
        "startDate",
        "endDate",
        "status",
        "dailyProfit",
        "totalProfit"
      ]
    },
    "Car": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Car",
      "type": "object",
      "description": "Represents a car available for investment.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the car."
        },
        "name": {
          "type": "string",
          "description": "Name of the car."
        },
        "model": {
          "type": "string",
          "description": "Model of the car."
        },
        "year": {
          "type": "number",
          "description": "Year the car was manufactured."
        },
        "image": {
          "type": "string",
          "description": "URL of the car's image."
        },
        "totalValue": {
          "type": "number",
          "description": "Total value of the car."
        },
        "investedAmount": {
          "type": "number",
          "description": "Total amount invested in the car."
        },
        "roi": {
          "type": "number",
          "description": "Return on investment percentage for the car."
        },
        "status": {
          "type": "string",
          "description": "Status of the car (e.g., available, fully invested)."
        },
        "description": {
          "type": "string",
          "description": "Description of the car."
        }
      },
      "required": [
        "id",
        "name",
        "model",
        "year",
        "image",
        "totalValue",
        "investedAmount",
        "roi",
        "status"
      ]
    },
    "Referral": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Referral",
      "type": "object",
      "description": "Represents a referral relationship between two users.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the referral."
        },
        "referrerId": {
          "type": "string",
          "description": "Reference to User who made the referral. (Relationship: User 1:N Referral)"
        },
        "referredId": {
          "type": "string",
          "description": "Reference to User who was referred."
        },
         "referredName": {
          "type": "string",
          "description": "Name of the user who was referred."
        },
         "referredEmail": {
          "type": "string",
          "description": "Email of the user who was referred."
        },
        "level": {
          "type": "number",
          "description": "Referral level (e.g., 1, 2, 3)."
        },
        "commissionRate": {
          "type": "number",
          "description": "Commission rate for the referral."
        },
        "earned": {
          "type": "number",
          "description": "Amount earned from the referral."
        },
        "status": {
          "type": "string",
          "description": "Status of the referral (e.g., active, inactive)."
        }
      },
      "required": [
        "id",
        "referrerId",
        "referredId",
        "level",
        "commissionRate",
        "earned",
        "status"
      ]
    },
    "Withdrawal": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Withdrawal",
      "type": "object",
      "description": "Represents a withdrawal request made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the withdrawal."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who made the withdrawal request. (Relationship: User 1:N Withdrawal)"
        },
        "amount": {
          "type": "number",
          "description": "Amount requested for withdrawal."
        },
        "method": {
          "type": "string",
          "description": "Withdrawal method (e.g., mobile money, bank transfer)."
        },
        "details": {
          "type": "string",
          "description": "Withdrawal details (JSON format)."
        },
        "status": {
          "type": "string",
          "description": "Status of the withdrawal (e.g., pending, processed, rejected)."
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time when the withdrawal request was created.",
          "format": "date-time"
        },
        "processedAt": {
          "type": "string",
          "description": "Date and time when the withdrawal request was processed.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "amount",
        "method",
        "details",
        "status",
        "createdAt"
      ]
    },
    "Transaction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Transaction",
      "type": "object",
      "description": "Represents a transaction made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the transaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User who made the transaction. (Relationship: User 1:N Transaction)"
        },
        "type": {
          "type": "string",
          "description": "Type of transaction (e.g., deposit, withdrawal, investment)."
        },
        "amount": {
          "type": "number",
          "description": "Amount of the transaction."
        },
        "balanceAfter": {
          "type": "number",
          "description": "User's account balance after the transaction."
        },
        "description": {
          "type": "string",
          "description": "Description of the transaction."
        },
        "createdAt": {
          "type": "string",
          "description": "Date and time when the transaction was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "type",
        "amount",
        "balanceAfter",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. Uses path-based ownership for private user data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/investments/{investmentId}",
        "definition": {
          "entityName": "Investment",
          "schema": {
            "$ref": "#/backend/entities/Investment"
          },
          "description": "Stores investments made by a specific user. Uses hierarchical paths for user-owned data, enhancing security.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "investmentId",
              "description": "The unique identifier for the investment."
            }
          ]
        }
      },
      {
        "path": "/cars/{carId}",
        "definition": {
          "entityName": "Car",
          "schema": {
            "$ref": "#/backend/entities/Car"
          },
          "description": "Stores car details available for investment.",
          "params": [
            {
              "name": "carId",
              "description": "The unique identifier for the car."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/referrals/{referralId}",
        "definition": {
          "entityName": "Referral",
          "schema": {
            "$ref": "#/backend/entities/Referral"
          },
          "description": "Stores referral relationships for a user. Uses hierarchical paths for user-owned referral data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "referralId",
              "description": "The unique identifier for the referral."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/withdrawals/{withdrawalId}",
        "definition": {
          "entityName": "Withdrawal",
          "schema": {
            "$ref": "#/backend/entities/Withdrawal"
          },
          "description": "Stores withdrawal requests made by a user. Uses hierarchical paths for user-owned withdrawal data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "withdrawalId",
              "description": "The unique identifier for the withdrawal."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/transactions/{transactionId}",
        "definition": {
          "entityName": "Transaction",
          "schema": {
            "$ref": "#/backend/entities/Transaction"
          },
          "description": "Stores transaction history for a user. Uses hierarchical paths for user-owned transaction data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "transactionId",
              "description": "The unique identifier for the transaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to ensure security, scalability, and ease of debugging, adhering to the core design principles of Authorization Independence, Clarity of Intent, DBAC (Database-Based Access Control), and QAPs (Rules are not Filters). Authorization Independence is achieved through denormalization. For instance, access to investments, referrals, withdrawals, and transactions related to a user is controlled by the user's ID within those documents, avoiding hierarchical `get()` calls. Structural Segregation is used by separating data based on access needs. Private user data is stored under `/users/{userId}`, while global data like available cars is stored in the `/cars` collection. Access Modeling uses path-based ownership (`/users/{userId}/investments/{investmentId}`) for user-owned data. The design facilitates secure list operations (QAPs) by ensuring that collections only contain documents with the same security requirements, avoiding the need for complex filtering in rules. This structure ensures robust security rules, simplifies debugging, and supports atomic operations."
  }
}
